<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>稿库系统后台管理</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Bootstrap core CSS -->
    <link href="__PUBLIC__/css/Admin/bootstrap.min.css" rel="stylesheet">

    <!-- Font Awesome -->
    <link href="__PUBLIC__/css/Admin/font-awesome.min.css" rel="stylesheet">


    <link href="__PUBLIC__/css/Admin/summernote.css" rel="stylesheet">

    <!-- ionicons -->
    <link href="__PUBLIC__/css/Admin/ionicons.min.css" rel="stylesheet">

    <!-- Simplify -->
    <link href="__PUBLIC__/css/Admin/simplify.css" rel="stylesheet">

    <link rel="stylesheet" href="__PUBLIC__/css/Admin/uploadifive.css">

    <link href="__PUBLIC__/css/Admin/common.css" rel="stylesheet">

    <style>
        #scoreBtn .active{
            /*color: #edbc6c;*/
            background: #fbc852;
            transition: all 0.3s ease;
            -webkit-transition: all 0.3s ease;
            -moz-transition: all 0.3s ease;
            -ms-transition: all 0.3s ease;
            -o-transition: all 0.3s ease;
        }
    </style>
</head>

<body class="overflow-hidden">
<div class="wrapper preload">
    <!-- 导入 nav-->
    <include file='./header' />

    <!-- 导入左边栏-->
    <include file='./aside'/>

    <div class="main-container">
        <div class="padding-md">
            <div class="row user-profile-wrapper">

                <!--加入通知模态框-->
                <include file='./noticeModel'/>


                <notempty name = "all">
                    <include file='./Post/allPost' />  <!-- 导入 所有用户-->
                </notempty>

                <notempty name = "the">
                    <include file='./Post/thePost' />   <!-- 导入 修改用户-->
                </notempty>

                <notempty name = "add">
                    <include file='./Post/addPost' />   <!-- 导入 追加用户-->
                </notempty>

            </div>
        </div>
    </div><!-- /main-container -->
    <!-- 导入footer -->
    <include file = './footer'/>
</div><!-- /wrapper -->

<a href="#" class="scroll-to-top hidden-print"><i class="fa fa-chevron-up fa-lg"></i></a>

<!-- Jquery -->
<script src="__PUBLIC__/js/Admin/jquery-1.11.1.min.js"></script>

<!-- Bootstrap -->
<script src="__PUBLIC__/js/Admin/bootstrap.min.js"></script>

<!-- Slimscroll -->
<script src='__PUBLIC__/js/Admin/jquery.slimscroll.min.js'></script>

<!-- Simplify -->
<script src="__PUBLIC__/js/Admin/simplify.js"></script>

<script src='__PUBLIC__/js/Admin/jquery.uploadifive.min.js'></script>

<script src="__PUBLIC__/js/common.js?v=20160101"></script>
<script src="__PUBLIC__/js/Admin/post.js?v=20160106"></script>

<script src="__PUBLIC__/js/Admin/summernote.min.js"></script>
<script src="__PUBLIC__/js/Admin/summernote-zh-CN.js"></script>


<script type="text/javascript">
    var PUBLIC= "__PUBLIC__";
    var ROOT = "__ROOT__";

    //全局变量角色
    var BAOLIAOZHE = 1;       //爆料者
    var XIAOBIAN   = 2;       //小编
    var ZONGBIAN   = 3;       //总编
    var DEPT_ADMIN = 4;       //部门管理员
    var ADMIN      = 88;      //管理员

    $(document).ready(function()
    {
        var i = 0;
        $('#file_upload').uploadifive({
            'uploadScript' : './Admin/Post/doAction/action/uploadAttachment',   //上传的方法
            'buttonText' : '上传资源',
            'fileTypeExts'  : '*.zip;*.7z;*.rar;*.jpg;*.jpge;*.gif;*.txt;*.xls;*.pdf;*.doc;*.xlsx;*.docx;*.pptx;*.png',
            'fileSizeLimit' : 5242880,
            'removeCompleted':true,
            'onUploadComplete' : function(file, data) {

                var json = jQuery.parseJSON(data);
                if(json.success == 1){

                    i++;

                    var html = '<div class="gallery-item" id="'+i+'">';
                    html += '<span id="path'+i+'" style="display: none;">'+json.path+'</span>';
                    html += '<span id="saveName'+i+'" style="display: none;">'+json.saveName+'</span>';
                    html += '<span id="fileName'+i+'" style="display: none;">'+json.fileName+'</span>';
                    html += '<div class="gallery-wrapper">';
                    html += '<a class="gallery-remove" onclick="return removeAttachment(\''+i+'\',\''+json.path+'\',\''+json.saveName+'\') "><i class="fa fa-times"></i></a>';
                    html += '<img class = textAttachmenthow src=__PUBLIC__/img/Admin/media/textAttachment.png>';
                    html += '<div class="gallery-title" id="title'+json.saveName+'">';
                    html += '<a href = "__ROOT__/Admin/Media/doAction/action/getStatus/status/me">'+json.fileName+'</a>';
                    html += '</div>';
                    html += '</div>';
                    html += '</div>';

                    $("#imgs").append(html);
                    $("#attachmentDiv").fadeIn();

                }else{
                    alert(json.msg);
                    return false;
                }

            },
            'onError': function(errorType) {
                alert('The error was: ' + errorType);
            }
        });
        i=0;

    });

    /**
     * 如果点击删除按钮则先获取文件的名称,将名称传入后删除对应的ID
     * @param num   传入的第几个文件
     * @param path  上传路径
     * @param saveName  附件名称
     */
    function removeAttachment (num,path,saveName) {

        $.ajax({
            url:ROOT+"/Admin/Post/doAction/action/delAttachment"//改为你的动态页
            ,type:"POST"
            ,data:{
                'path':path
            }
            ,dataType: "json"
            ,beforeSend: function(){
                $('#title'+saveName).html('正在删除...');
            }
            ,success:function(json){
                if(json.success == 1){
                    $('#'+num).remove();
                }else{
                    alert(json.msg);
                    return false;
                }

                //判断是否都删除完毕了,则将img的div隐藏起来
                if($('.gallery-item').length == 0){
                    $("#attachmentDiv").hide();
                }

            }
            ,error:function(xhr){alert('PHP页面有错误！'+xhr.responseText);}
        });
    }

</script>




</body>
</html>