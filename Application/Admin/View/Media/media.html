<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>稿库系统后台管理</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="">

    <!-- Bootstrap core CSS -->
    <link href="__PUBLIC__/css/Admin/bootstrap.min.css" rel="stylesheet">

    <!-- Font Awesome -->
    <link href="__PUBLIC__/css/Admin/font-awesome.min.css" rel="stylesheet">


    <link href="__PUBLIC__/css/Admin/summernote.css" rel="stylesheet">

    <!-- ionicons -->
    <link href="__PUBLIC__/css/Admin/ionicons.min.css" rel="stylesheet">

    <!-- Simplify -->
    <link href="__PUBLIC__/css/Admin/simplify.css" rel="stylesheet">

    <!--<link rel="stylesheet" href="__PUBLIC__/css/Admin/uploadify.css">-->
    <link rel="stylesheet" href="__PUBLIC__/css/Admin/uploadifive.css">

    <link href="__PUBLIC__/css/Admin/common.css" rel="stylesheet">

</head>

<body class="overflow-hidden">
<div class="wrapper preload">
    <!-- 导入 nav-->
    <include file='./header' />

    <!-- 导入左边栏-->
    <include file='./aside'/>

    <div class="main-container">

        <!--加入通知模态框-->
        <include file='./noticeModel'/>

        <notempty name = "all">
            <include file='./Media/allMedia' />  <!-- 导入 所有用户-->
        </notempty>

        <notempty name = "the">
            <include file='./Media/theMedia' />   <!-- 导入 修改用户-->
        </notempty>

        <notempty name = "add">
            <include file='./Media/addMedia' />   <!-- 导入 追加用户-->
        </notempty>
    </div><!-- /main-container -->
    <!-- 导入footer -->
    <include file = './footer'/>
</div><!-- /wrapper -->

<a href="#" class="scroll-to-top hidden-print"><i class="fa fa-chevron-up fa-lg"></i></a>

<!-- Jquery -->
<script src="__PUBLIC__/js/Admin/jquery-1.11.1.min.js"></script>

<!-- Bootstrap -->
<script src="__PUBLIC__/js/Admin/bootstrap.min.js"></script>

<!-- Slimscroll -->
<script src='__PUBLIC__/js/Admin/jquery.slimscroll.min.js'></script>

<!-- Modernizr -->
<script src='__PUBLIC__/js/Admin/modernizr.min.js'></script>

<!-- Simplify -->
<script src="__PUBLIC__/js/Admin/simplify/simplify.js"></script>


<!--<script src='__PUBLIC__/js/Admin/jquery.uploadify.js'></script>-->
<script src='__PUBLIC__/js/Admin/jquery.uploadifive.min.js'></script>


<script src="__PUBLIC__/js/common.js?v=20160101"></script>


<script src="__PUBLIC__/js/Admin/summernote.min.js"></script>
<script src="__PUBLIC__/js/Admin/summernote-zh-CN.js"></script>


<script type="text/javascript">
    var PUBLIC= "__PUBLIC__";
    var ROOT = "__ROOT__";

    //全局变量角色
    var BAOLIAOZHE = 1;       //爆料者
    var XIAOBIAN   = 2;       //小编
    var ZONGBIAN   = 3;       //总编
    var DEPT_ADMIN = 4;       //部门管理员
    var ADMIN      = 88;      //管理员

    $(document).ready(function()
    {

        $('#file_upload').uploadifive({
//        'queueID'  : 'some_file_queue',
//            'swf'      : '__PUBLIC__/uploadify.swf',
            'uploadScript' : './Admin/Media/doAction/action/upload',   //上传的方法
            'buttonText' : '上传资源',
            'fileTypeExts'  : '*.jpg;*.jpge;*.gif;*.txt;*.xls;*.pdf;*.doc;*.xlsx;*.docx;*.pptx;*.png',
            'fileSizeLimit' : 5242880,
            'removeCompleted':true,
            'onUploadComplete' : function(file, data) {

                var json = jQuery.parseJSON(data);

                if(json.success == 1){

                    if(json.msg.indexOf('jpg') > -1
                            || json.msg.indexOf('jpge') > -1
                            || json.msg.indexOf('png') > -1
                            || json.msg.indexOf('gif') > -1){

                        var html = '<div class="gallery-item" id="'+json.name+'">';
                        html += '<div class="gallery-wrapper">';
                        html += '<a class="gallery-remove" onclick="return removeImg('+json.id+',\''+json.day+'\',\''+json.name+'\',\''+json.ext+'\') "><i class="fa fa-times"></i></a>';
                        html += '<img id= imgId src=__PUBLIC__'+json.msg+'>';
                        html += '<div class="gallery-title" id="title'+json.name+'">';
                        html += '<a href = "__ROOT__/Admin/Media/doAction/action/getStatus/status/me">前往资源库修改</a>';
                        html += '</div>';
                        html += '<div class="gallery-overlay">';
                        html += '<a target="_blank" href="__PUBLIC__'+json.msg+'" class="gallery-action enlarged-photo">';
                        html += '<i class="fa fa-search-plus fa-lg"></i>';
                        html += '</a>';
                        //html += '<a href="#" onclick="return doModel('+json.id+',\''+json.msg+'\');" class="gallery-action animation-dalay"><i class="fa fa-edit fa-lg"></i></a>';
                        html += '</div>';
                        html += '</div>';
                        html += '</div>';

                        $("#imgs").append(html);
                    }else{
                        var html = '<div class="gallery-item" id="'+json.name+'">';
                        html += '<div class="gallery-wrapper">';
                        html += '<a class="gallery-remove" onclick="return removeImg(\''+json.id+'\',\''+json.day+'\',\''+json.name+'\',\''+json.ext+'\') "><i class="fa fa-times"></i></a>';
                        html += '<img class = textshow src=__PUBLIC__/img/Admin/media/text.png>';
                        html += '<div class="gallery-title" id="title'+json.name+'">';
                        html += '<a href = "__ROOT__/Admin/Media/doAction/action/getStatus/status/me">前往资源库修改</a>';
                        html += '</div>';
                        html += '<div class="gallery-overlay">';
                        html += '<a target="_blank" href="__PUBLIC__'+json.msg+'" class="gallery-action enlarged-photo">';
                        html += '<i class="fa fa-search-plus fa-lg"></i>';
                        html += '</a>';
                        //html += '<a href="#" onclick="return doModel('+json.id+',\''+json.msg+'\');" class="gallery-action animation-dalay"><i class="fa fa-edit fa-lg"></i></a>';
                        html += '</div>';
                        html += '</div>';
                        html += '</div>';

                        $("#imgs").append(html);
                    }
                }else{
                    alert(json.msg);
                    return false;
                }

            },
            'onError': function(errorType) {
                alert('The error was: ' + errorType);
            }
        });

//    $('#file_upload').uploadify({
////        'queueID'  : 'some_file_queue',
//        'swf'      : '__PUBLIC__/uploadify.swf',
//        'uploader' : './Admin/Media/doAction/action/upload',   //上传的方法
//        'buttonText' : '上传资源',
//        'fileTypeExts'  : '*.jpg;*.jpge;*.gif;*.txt;*.xls;*.pdf;*.doc;*.xlsx;*.docx;*.pptx;*.png',
//        'fileSizeLimit' : '5MB',
//        'onUploadSuccess' : function(file, data, response) {
//
//            var json = jQuery.parseJSON(data);
//
//            if(json.success == 1){
//
//                if(json.msg.indexOf('jpg') > -1
//                        || json.msg.indexOf('jpge') > -1
//                        || json.msg.indexOf('png') > -1
//                        || json.msg.indexOf('gif') > -1){
//
//                    var html = '<div class="gallery-item" id="'+json.name+'">';
//                    html += '<div class="gallery-wrapper">';
//                    html += '<a class="gallery-remove" onclick="return removeImg('+json.id+',\''+json.day+'\',\''+json.name+'\',\''+json.ext+'\') "><i class="fa fa-times"></i></a>';
//                    html += '<img id= imgId src=__PUBLIC__'+json.msg+'>';
//                    html += '<div class="gallery-title" id="title'+json.name+'">';
//                    html += '<a href = "__ROOT__/Admin/Media/doAction/action/getStatus/status/me">前往资源库修改</a>';
//                    html += '</div>';
//                    html += '<div class="gallery-overlay">';
//                    html += '<a target="_blank" href="__PUBLIC__'+json.msg+'" class="gallery-action enlarged-photo">';
//                    html += '<i class="fa fa-search-plus fa-lg"></i>';
//                    html += '</a>';
//                    //html += '<a href="#" onclick="return doModel('+json.id+',\''+json.msg+'\');" class="gallery-action animation-dalay"><i class="fa fa-edit fa-lg"></i></a>';
//                    html += '</div>';
//                    html += '</div>';
//                    html += '</div>';
//
//                    $("#imgs").append(html);
//                }else{
//                    var html = '<div class="gallery-item" id="'+json.name+'">';
//                    html += '<div class="gallery-wrapper">';
//                    html += '<a class="gallery-remove" onclick="return removeImg(\''+json.id+'\',\''+json.day+'\',\''+json.name+'\',\''+json.ext+'\') "><i class="fa fa-times"></i></a>';
//                    html += '<img class = textshow src=__PUBLIC__/img/Admin/media/text.png>';
//                    html += '<div class="gallery-title" id="title'+json.name+'">';
//                    html += '<a href = "__ROOT__/Admin/Media/doAction/action/getStatus/status/me">前往资源库修改</a>';
//                    html += '</div>';
//                    html += '<div class="gallery-overlay">';
//                    html += '<a target="_blank" href="__PUBLIC__'+json.msg+'" class="gallery-action enlarged-photo">';
//                    html += '<i class="fa fa-search-plus fa-lg"></i>';
//                    html += '</a>';
//                    //html += '<a href="#" onclick="return doModel('+json.id+',\''+json.msg+'\');" class="gallery-action animation-dalay"><i class="fa fa-edit fa-lg"></i></a>';
//                    html += '</div>';
//                    html += '</div>';
//                    html += '</div>';
//
//                    $("#imgs").append(html);
//                }
//            }else{
//                alert(json.msg);
//                return false;
//            }
//
//        }
//    });

});

    /**
     * 如果点击删除图片按钮则先获取图片的名称,将名称传入后删除对应的ID
     * @param data
     */
    function removeImg (id,day,name,ext) {

        $.ajax({
            url:ROOT+"/Admin/Media/doAction/action/delImg"//改为你的动态页
            ,type:"POST"
            ,data:{
                'id':id,
                'img':day+'/'+ name + '.' + ext
            }
            ,dataType: "json"
            ,beforeSend: function(){
                $('#title'+name).html('正在删除...');
            }
            ,success:function(json){
                if(json.success == 1){
                    $('#'+name).remove();
                }else{

                    alert(json.msg);
                    return false;
                }
            }
            ,error:function(xhr){alert('PHP页面有错误！'+xhr.responseText);}
        });
    }
</script>


</body>
</html>